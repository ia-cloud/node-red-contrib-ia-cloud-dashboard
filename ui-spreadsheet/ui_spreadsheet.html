<script type="text/javascript">
    RED.nodes.registerType('ui_spreadsheet',{
        category: 'iaCloud dashboard',
        color: 'rgb(119, 198, 204)',
        defaults: {
            // configSel: {value:"inchartSet", required:true},
            confsel: {value:"inchartSet"},
            group: {type: 'ui_group', required:false},
            name: {value: ''},
            label: {value:''},
            order: {value: 0},
            width: {value: 0,
                    validate: function(v) {
                        var valid = true
                        var width = v||0;
                        var currentGroup = $('#node-input-group').val()|| this.group;
                        var groupNode = RED.nodes.node(currentGroup);
                        valid = !groupNode || +width <= +groupNode.width;
                        $("#node-input-size").toggleClass("input-error",!valid);
                        return valid;
                }},
            height: {value: 0},
            item: {value: ""},
            storeOutMessages: {value: true},
            fwdInMessages: {value: true},
            templateScope: {value: 'local'}
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "ia-cloud.png",
        paletteLabel: 'spreadsheet',
        label: function() { return this.name || 'ui_spreadsheet'; },
        oneditprepare: function() {
            var that = this;
            $("#node-input-size").elementSizer({
                width: "#node-input-width",
                height: "#node-input-height",
                group: "#node-input-group"
            });

            /*
            if (typeof this.storeOutMessages === 'undefined') {
                this.storeOutMessages = true;
                $('#node-input-storeOutMessages').prop('checked', true);
            }

            if (typeof this.fwdInMessages === 'undefined') {
                this.fwdInMessages = true;
                $('#node-input-fwdInMessages').prop('checked', true);
            }
            */

            $('input[name="configSel"]:radio').change(function() {
                if ($("#node-input-configSel1").is(":checked")) {
                    $("#node-row-item").hide();
                    $('#node-input-confsel').val("inchartSet");
                } else {
                    $("#node-row-item").show();
                    $('#node-input-confsel').val("formatSet");
                }
            });
            
            if($("#node-input-confsel").val() == "inchartSet"){
                $('#node-input-configSel1').prop('checked', true);
            } else {
                $('#node-input-configSel2').prop('checked', true);
            }
            $('input[name="configSel"]:radio').change();

        }
        
    });
</script>

<script type="text/x-red" data-template-name="ui_ui_spreadsheet">

    <!-- 入力値設定 -->
    <label style="width: 100%;" for="node-input-setMode" ><i class="fa fa-list"></i>  入力値</label>
    <div class="form-row">
        <input type="text" style="display: none;" id="node-input-confsel" valie="inchartSet">
        <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
              name="configSel" id="node-input-configSel1"
              value="inchartSet" checked="checked">
        <label style="width: 40%;" for="node-input-configSel1"> json2inchartからの出力</label>
        <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
              name="configSel" id="node-input-configSel2" value="formatSet">
        <label style="width: 40%;" for="node-input-configSel2"> 基本フォーマットデータ</label>
    </div>

    <!-- グループ -->
	<div class="form-row" id="template-row-group">
        <label for="node-input-group"><i class="fa fa-table"></i> Group</label>
        <input type="text" id="node-input-group">
    </div>

    <!-- 表示サイズ -->
    <div class="form-row" id="template-row-size">
        <label><i class="fa fa-object-group"></i> サイズ</label>
        <input type="hidden" id="node-input-width">
        <input type="hidden" id="node-input-height">
        <button class="editor-button" id="node-input-size"></button>
    </div>

    <!-- ラベル -->
    <div class="form-row">
        <label for="node-input-label"><i class="fa fa-i-cursor"></i> ラベル</label>
        <input type="text" id="node-input-label">
    </div>

    
    <!-- 入力・出力オプション -->
    <!--
    <div id="template-pass-store">
        <div class="form-row" style="margin-bottom:0px;">
            <label>&nbsp;</label>
            <input type="checkbox" id="node-input-fwdInMessages" style="display:inline-block; width:auto; vertical-align:top;">
            <label for="node-input-fwdInMessages" style="width:70%;"> 入力からメッセージを渡す </label>
        </div>
        <div class="form-row" style="margin-bottom:0px;">
            <label>&nbsp;</label>
            <input type="checkbox" id="node-input-storeOutMessages" style="display:inline-block; width:auto; vertical-align:top;">
            <label for="node-input-storeOutMessages" style="width:70%;"> 保存された状態に出力メッセージを追加 </label>
        </div>
    </div>
    -->

    <!-- 項目名 -->
    <div class="form-group hide" id="node-row-item" style="width:300px;">
        <div class="form-row">
            <label for="node-input-item"><i class="fa fa-list"></i> 項目名</label>
            <input type="text" id="node-input-item">
        </div>
    </div>

    <!-- ノード名 -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> ノード名</label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="ui_spreadsheet">
    <p>ダッシュボードにテーブル(表)を表示します。「ノード：<a herf="https://github.com/node-red/node-red-dashboard">node-red-contrib-dashboard</a>」内のウィジェット追加方法
        [<a herf="https://github.com/node-red/node-red-dashboard/wiki/Creating-New-Dashboard-Widgets">Creating New Dashboard Widgets</a>]を参考に実装したノードです。</p>
    <h3>入力メッセージ</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">object</span></dt>
        <dd>「ノード：<a href="https://github.com/ia-cloud/node-red-contrib-ia-cloud-output/tree/master/json2inchart-iacloud">node-red-contrib-json2inchart-iacloud</a>」からの出力結果　または
            「ノード：<a herf="https://github.com/node-red/node-red-dashboard">node-red-contrib-dashboard</a>」 - chartと同様のフォーマット。詳しくは<a herf="https://github.com/node-red/node-red-dashboard/blob/master/Charts.md">本ドキュメント</a>を参照</dd>
    </dl>
    <h3>詳細説明</h3>
    <p>このノードは「ノード：<a href="https://github.com/ia-cloud/node-red-contrib-ia-cloud-output/tree/master/json2inchart-iacloud">node-red-contrib-json2inchart-iacloud</a>」
        からの出力を直接本ノードに入力して使用することができます。
    <p>上記ノードからの出力を使用せず、基本フォーマットデータを入力する場合は、以下プロパティを設定する必要があります。</p>
    <ul>
        <li><code>項目名</code> - (文字列)データ表示時の項目名をカンマ区切りで入力する</li>
    </ul>
</script>
