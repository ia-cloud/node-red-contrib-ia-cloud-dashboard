<script type="text/javascript">
    RED.nodes.registerType('ui_table',{
        category: 'iaCloud dashboard',
        color: 'rgb(119, 198, 204)',
        defaults: {
            confsel: {value:"inchartSet"},
            group: {type: 'ui_group', required:false},
            name: {value: ''},
            label: {value:''},
            order: {value: 0},
            width: {value: 0,
                    validate: function(v) {
                        var valid = true
                        var width = v||0;
                        var currentGroup = $('#node-input-group').val()|| this.group;
                        var groupNode = RED.nodes.node(currentGroup);
                        valid = !groupNode || +width <= +groupNode.width;
                        $("#node-input-size").toggleClass("input-error",!valid);
                        return valid;
                }},
            height: {value: 0},
            item: {value: ""},
            storeOutMessages: {value: true},
            fwdInMessages: {value: true},
            templateScope: {value: 'local'}
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "ia-cloud.png",
        paletteLabel: 'table',
        label: function() { return this.name || 'table'; },
        oneditprepare: function() {
            var that = this;
            $("#node-input-size").elementSizer({
                width: "#node-input-width",
                height: "#node-input-height",
                group: "#node-input-group"
            });

            // 入力値オプション
            $('input[name="configSel"]:radio').change(function() {
                if ($("#node-input-configSel1").is(":checked")) {
                    $("#node-row-item").hide();
                    $('#node-input-confsel').val("inchartSet");
                } else {
                    $("#node-row-item").show();
                    $('#node-input-confsel').val("formatSet");
                }
            });
            
            if($("#node-input-confsel").val() == "inchartSet"){
                $('#node-input-configSel1').prop('checked', true);
            } else {
                $('#node-input-configSel2').prop('checked', true);
            }
            $('input[name="configSel"]:radio').change();

        }
        
    });
</script>

<script type="text/x-red" data-template-name="ui_table">

    <!-- グループ -->
	<div class="form-row" id="template-row-group">
        <label for="node-input-group"><i class="fa fa-table"></i> <span data-i18n="table.label.group"></span></label>
        <input type="text" id="node-input-group">
    </div>

    <!-- 表示サイズ -->
    <div class="form-row" id="template-row-size">
        <label><i class="fa fa-object-group"></i> <span data-i18n="table.label.size"></span></label>
        <input type="hidden" id="node-input-width">
        <input type="hidden" id="node-input-height">
        <button class="editor-button" id="node-input-size"></button>
    </div>

    <!-- ラベル -->
    <div class="form-row">
        <label for="node-input-label"><i class="fa fa-i-cursor"></i> <span data-i18n="table.label.label"></span></label>
        <input type="text" id="node-input-label">
    </div>

    <!-- 入力値設定 -->
    <div class="form-row">
    <label for="node-input-setMode"><i class="fa fa-list"></i> <span data-i18n="table.label.input"></span></label>
        <input type="text" style="display: none;" id="node-input-confsel" valie="inchartSet">
        <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
              name="configSel" id="node-input-configSel1"
              value="inchartSet" checked="checked">
        <label style="width: 30%;" for="node-input-configSel1"> <span data-i18n="table.input.getchartdata"></span></label>
        <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
              name="configSel" id="node-input-configSel2" value="formatSet">
        <label style="width: 30%;" for="node-input-configSel2"> <span data-i18n="table.input.formatdata"></span></label>
    </div>

    <!-- 項目名 -->
    <div class="form-group hide" id="node-row-item" style="width:300px;">
        <div class="form-row" style="margin-left: 110px">
            <label for="node-input-item"> <span data-i18n="table.input.item"></label>
        </div>
        <div class="form-row" style="margin-left: 110px">
            <input type="text" id="node-input-item" style="width: 250px">
        </div>
    </div>

    <!-- ノード名 -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="table.label.name"></label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="ui_table">
    en-US
</script>
