<script type="text/javascript">
	RED.nodes.registerType('DynamoDB',{
		category: 'iaCloud dashboard',
		color:"#ffd700",
		defaults: {
			name: {value: ""},
			tableName: {value: "", required:true},
			operation: {value: "Query" },
			objectKey: {value: "", required:true},
			dateCheck: {value:"datesetInput"},
			sdate: {value: ""},
			edate: {value: ""},
			aggregationCheck: {value: false},
			aggregation: {value: "max"},
			aggreunit: {value: "year"},
			decimalPoint: {value: "noexe"},
			sort: {value: "true"},
			limit: {value: ""},
			Item: { value: ""}
		},
		credentials: {
			userID: {type:"text", required:true},
            password: {type: "password", required:true}
		},
		inputs:1,
		outputs:1,
		icon: "ia-cloud.png",
		align: "right",
		label: function() {
			return this.name || "DynamoDB " + this.operation;
		},
		oneditprepare: function () {

			// 機能毎に表示する項目を変更
			$('#node-input-operation').change(function() {
				if ($('#node-input-operation').val() == "Query") {
					// Queryの場合
					$("#node-row-ScanQuerySet").show();
					$("#node-row-QuerySet").show();
					$("#node-row-PutItemSet").hide();
					if ($("#node-input-aggregationCheck").prop("checked")) {
						$("#node-row-QuerySortSet").hide();
					} else {
						$("#node-row-QuerySortSet").show();
					}
				} else if ($('#node-input-operation').val() == "Scan") {
					// Scanの場合
					$("#node-row-ScanQuerySet").show();
					$("#node-row-QuerySet").hide();
					$("#node-row-QuerySortSet").hide();
					$("#node-row-PutItemSet").hide();
				} else if ($('#node-input-operation').val() == "PutItem") {
					// PutItemの場合
					$("#node-row-ScanQuerySet").hide();
					$("#node-row-QuerySet").hide();
					$("#node-row-QuerySortSet").hide();
					$("#node-row-PutItemSet").show();
				}
			});


			// 期間入力オプション
			$('input[name="configSel"]:radio').change(function() {
                if ($("#node-input-configSel1").is(":checked")) {
                    $(".node-input-manualInput-row").hide();
                    $('#node-input-dateCheck').val("datesetInput");
                } else {
                    $(".node-input-manualInput-row").show();
                    $('#node-input-dateCheck').val("manualInput");
                }
            });
			
            if($("#node-input-dateCheck").val() == "datesetInput"){
                $('#node-input-configSel1').prop('checked', true);
            } else {
                $('#node-input-configSel2').prop('checked', true);
            }
            $('input[name="configSel"]:radio').change();
			

			// アグリゲーションオプション
			$("#node-input-aggregationCheck").change(function() {
                if ($(this).is(":checked")) {
					$(".node-input-aggregation-row").show();
					$("#node-row-QuerySortSet").hide();
					$("#node-input-aggregationCheck").prop("checked", true);
                } else {
					$(".node-input-aggregation-row").hide();
					$("#node-row-QuerySortSet").show();
					$("#node-input-aggregationCheck").prop("checked", false);
                }
			});
		
		}
	
	});
</script>

<script type="text/x-red" data-template-name="DynamoDB">

<!--	<style scoped>
				.hiddenAttrs {display:none;}
				.visibleAttrs {display:block;}
		</style> -->

	<!-- ノード名 -->
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-user"></i> <span data-i18n="dynamodb.label.name"></span></label>
		<input type="text" id="node-input-name" placeholder="Name"></input>
	</div>
	<hr/>

	<!-- ユーザID -->
	<div class="form-row">
		<label for="node-input-userID"><i class="fa fa-tag"></i> <span data-i18n="dynamodb.label.username"></span><span style="color: #ff0000;">*</span></label>
		<input type="text" id="node-input-userID" placeholder="userID"></input>
	</div>

	<!-- パスワード -->
	<div class="form-row">
		<label for="node-input-password"><i class="fa fa-key"></i> <span data-i18n="dynamodb.label.password"></span><span style="color: #ff0000;">*</span></label>
		<input type="password" id="node-input-password" placeholder="password"></input>
	</div>
	<hr/>

	<!-- テーブル名 -->
	<div class="form-row">
		<label for="node-input-tableName"><i class="fa fa-tag"></i> <span data-i18n="dynamodb.label.tableName"></span><span style="color: #ff0000;">*</span></label>
		<input type="text" id="node-input-tableName" placeholder="tableName"></input>
	</div>

	<!-- 機能 -->
	<div class="form-row">
		<label for="node-input-operation"><i class="fa fa-search"></i> <span data-i18n="dynamodb.label.operation"></span></label>
		<select type="text" id="node-input-operation">
			<option value="Query" data-i18n="dynamodb.operation.Query"></option>
			<option value="Scan" data-i18n="dynamodb.operation.Scan"></option>
			<option value="PutItem" data-i18n="dynamodb.operation.PutItem"></option>
		</select>
	</div>

	<!-- オブジェクトキー -->
	<div class="form-row">
		<label for="node-input-objectKey"><i class="fa fa-key"></i> <span data-i18n="dynamodb.label.objectKey"></span><span style="color: #ff0000;">*</span></label>
		<input type="text" id="node-input-objectKey" placeholder="objectKey"></input>
	</div>

	<!-- Queryで使用可能 -->
	<div class="form-group hide" id="node-row-QuerySet">
		<!-- 期間 -->
		<div class="form-row" style="width:450px;">
			<input type="text" style="display: none;" id="node-input-dateCheck" value="datesetInput">
			<label for="node-input-format" ><i class="fa fa-calendar"></i> <span data-i18n="dynamodb.label.period"></span></label>
			<input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
					name="configSel" id="node-input-configSel1"
					value="datesetInput" checked="checked">
			<label style="width: 30%;" for="node-input-configSel1"> <span data-i18n="dynamodb.period.datesetInput"></span></label>
			<input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
					name="configSel" id="node-input-configSel2" value="manualInput">
			<label style="width: 30%;" for="node-input-configSel2"> <span data-i18n="dynamodb.period.manualsetInput"></span></label>
		</div>
		<div style="margin-left: 110px" class="node-input-manualInput-row hide">
			<input type="date" style="width:140px;" id="node-input-sdate" placeholder="2018-01-01"></input>
			～
			<input type="date" style="width:140px;" id="node-input-edate" placeholder="2018-01-03"></input>
		</div>
	</div>
	<!-- Scan・Queryで使用可能 -->
	<div class="form-group hide"  id="node-row-ScanQuerySet">
		<!-- アグリゲーション -->
		<div class="form-row" style="width:450px;">
			<label for="node-input-aggregation"><i class="fa fa-calculator"></i> <span data-i18n="dynamodb.label.aggregation"></span></label>
			<input type="checkbox" id="node-input-aggregationCheck" style="display: inline-block; width: 20px; vertical-align: middle;>
			<label for="node-input-aggregationCheck" style="width: 40%; vertical-align: middle;">設定</label>
			
			<!-- アグリゲーション設定ONで表示 -->
			<div style="margin-left: 20px" class="node-input-aggregation-row hide">
				<div class="form-row" style="margin-left: 100px">
					<select type="text" id="node-input-aggregation" style="width:150px;">
						<option value="max" data-i18n="dynamodb.aggregation.max"></option>
						<option value="min" data-i18n="dynamodb.aggregation.min"></option>
						<option value="average" data-i18n="dynamodb.aggregation.average"></option>
						<option value="median" data-i18n="dynamodb.aggregation.median"></option>
						<option value="count" data-i18n="dynamodb.aggregation.count"></option>
						<!-- <option value="integration" data-i18n="dynamodb.aggregation.integration"></option> -->
						<option value="first" data-i18n="dynamodb.aggregation.first"></option>
						<option value="last" data-i18n="dynamodb.aggregation.last"></option>
					</select>
					　単位
					<select type="text" id="node-input-aggreunit" style="width:60px;">
						<option value="year" data-i18n="dynamodb.aggregation.year"></option>
						<option value="month" data-i18n="dynamodb.aggregation.month"></option>
						<option value="week" data-i18n="dynamodb.aggregation.week"></option>
						<option value="day" data-i18n="dynamodb.aggregation.day"></option>
						<option value="hour" data-i18n="dynamodb.aggregation.hour"></option>
						<option value="minute" data-i18n="dynamodb.aggregation.minute"></option>
						<option value="second" data-i18n="dynamodb.aggregation.second"></option>
					</select>
				</div>
			</div>
		</div>

		<!-- Scan・Queryで使用可能 -->
		<!-- 表示桁数 -->
		<div class="form-row">
			<label for="node-input-decimalPoint"><i class="fa fa-sliders"></i> <span data-i18n="dynamodb.label.round"></span></label>
			<select type="text" id="node-input-decimalPoint" style="width:120px;">
				<option value="noexe" data-i18n="dynamodb.round.noexe"></option>
				<option value="3" data-i18n="dynamodb.round.3"></option>
				<option value="2" data-i18n="dynamodb.round.2"></option>
				<option value="1" data-i18n="dynamodb.round.1"></option>
				<option value="0" data-i18n="dynamodb.round.0"></option>
				<option value="-1" data-i18n="dynamodb.round.-1"></option>
				<option value="-2" data-i18n="dynamodb.round.-2"></option>
				<option value="-3" data-i18n="dynamodb.round.-3"></option>
			</select>
		</div>

		<!-- Scan・Queryで使用可能 -->
		<!-- データ件数 -->
		<div class="form-row">
			<label for="node-input-limit"><i class="fa fa-clone"></i> <span data-i18n="dynamodb.label.limit"></span></label>
			<input type="text" style="width:130px;" id="node-input-limit" placeholder="100"></input>
		</div>
	</div>

	<!-- Query・アグリゲーション未使用で使用可能 -->
	<div class="form-group hide"  id="node-row-QuerySortSet">
		<!-- ソート -->
		<div class="form-row">
			<label for="node-input-sort"><i class="fa fa-sort"></i> <span data-i18n="dynamodb.label.sort"></span></label>
			<select type="text" style="width:80px;" id="node-input-sort">
				<option value="true" data-i18n="dynamodb.sort.asc"></option>
				<option value="false" data-i18n="dynamodb.sort.desc"></option>
			</select>
		</div>
	</div>

	<!-- PutItemで使用可能 -->
	<!-- Item設定 -->
	<div class="form-group hide"  id="node-row-PutItemSet">
		<div class="form-row">
			<label for="node-input-item"><i class="fa fa-tag"></i> <span data-i18n="dynamodb.label.item"></span></label>
			<input type="text" id="node-input-item" placeholder="item"></input>
		</div> 
	</div>
	

	<script>
		var nodeOps={

				Query:[
					'#tableName'
					],
				Scan:[
					'#tableName'
					],
				PutItem:[
					'#tableName','#itemAttr'
					]
		};
		$('#node-input-operation').on('change',function(){
			$('#AttrHolder').children().addClass('hiddenAttrs').removeClass('visibleAttrs');
			if (nodeOps[this.value]) {
				$(nodeOps[this.value].join()).addClass('visibleAttrs').removeClass('hiddenAttrs');
			}
		});
	</script>

</script>

<script type="text/x-red" data-help-name="DynamoDB">
	no en-US
</script>



